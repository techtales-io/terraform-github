---
version: 3
automerge: true
delete_source_branch_on_merge: true
projects:
  - name: terraform-github
    dir: .
    terraform_version: v1.5.7
    autoplan:
      when_modified: ["*.tf", "**/*.tf"]
    workflow: custom
workflows:
  custom:
    plan:
      steps:
        - env:
            name: SOPS_AGE_KEY_FILE
            value: /home/atlantis/.config/sops/age/terraform-github.txt
        - run: echo "hello world"
        - run: ls $SOPS_AGE_KEY_FILE
        - run: echo $USER_NAME
        - run: if [ $USER_NAME != "tyriis" ] && [ $USER_NAME != "jazzlyn" ]; then echo "NO!" && exit 1; fi
        - init
        - plan
    apply:
      steps:
        - env:
              name: SOPS_AGE_KEY_FILE
              value: /home/atlantis/.config/sops/age/terraform-github.txt
        - run: echo $USER_NAME
        - run: if [ $USER_NAME != "tyriis" ] && [ $USER_NAME != "jazzlyn" ]; then echo "NO!" && exit 1; fi
        - apply
